sudo: required
language: python
env:
  global:
  - secure: gxd63eOd43WAhcmxiCX7tkwg+AWO5jwm7KfEgP5Rnkxsyh8sQxqUbdTcC5Lddc48mOkIT5srvqkEwTHZm4Yi4T+v0d6RLmfLdpH4XbdvxP4WpAwiSlELpMmOb1dNpXeKL8TdEjnj8QvgMxoqWlpSbPFlps79E2A5w9Y4qQTX0yImPNFdOzo5MeRF9dNYrUjcHMRtQhjfuxuSE+y8HcMVkP1PF53vk8/+XJx7L90azbEvKbBzGLr3yBGqd8+Jk/HmMVPVRUn1V7A4kcKODF+besGJ7zyUBTap3MrH8kJZYQc0V/nA9gjamTdqW8HQBN7GcYDQF/IVQ9jD2wlMX0u200jdlnDYhTknMQLeOt9dDade2lvvPJNJ2f41JBVvG5zqzYbEm25XrNTH/T806kH3p1vnfppUJ1NEoTp3VFotcSPlY3xnKIMjDwJiCwYHZQKS0sC14vZ+0zfZn5cE6xcan0+rKWS5ktOf6/n+g2vUaniZlwcynIvWQ/ejb5t1tHamjeQ0wATMsQMIyL8hdi9flScenfG3NcaMuyI+MgzH3XIuts/OlqRN5D0nsQoAy9jCZS3UbW5mslWP+h86C2KDS4g2e/nnoyfyQQb7NB90V+sw5Wtp4mGDjoNjH6UKu+mXo29rnM9EA9+yr2rKDMVfs3Tjs6DDNtuPyXRA9oWjIoU=
  - secure: NkVPdCfjOU9C0R4Q21WqiMEOhyxWMb0UN0P1OLOYFBNPpxjQ+9lTo5mPzzyMeWNXK49rQdHhwtXASNPdsPmBlADufLsQUlqnvwU06gaY3TPCz9FsWEJDBAHSxOd/qCiazwKsxNzELtCDucUmAmSuVy/QT79um/52uQQ+qcQGHgx+XX9QhEfnOa5kSRPAQ2mFj2Fwv8CNhDnxE7rjdo2zzR75KLtY07XDZn8PyE8N4BrMELTeQBV5REuvaGRNzZIOmlFU4ZwSkUjpy4qxt73rraZupRkDWsVW5PJaiZ17Tc8/gUCQfQAyS7rW9iHUU9FeTXkBhpba1JNKgJfgmk9/G3Eijaoq2MGfayyhfWFzS0ISqq9Aeu4tNACsX2skco0BhZVgJjY8jvD2GEOHw8YdAieHr+Rkkghk4TQqpBmfOqTTRpDaM9PCnzmZQ/zmBOdbFVCtr2pXtmc6wLVhBMLlgU8jrhNrLhblrAk41nHPhlF1adxUG+VSL6TjHr5GRTJ8OSakk73NWfRGwDdsbUNNrCqGDnaGJW3x1/mJa4srJOI2KHnLAKpAIaxVeNiwmrswaYE3Z7lZi1yvdCMIrtRUcf5J8TwwRYEkdKgSS+yvouocKTc6H98kUgl3/8YCi3l8i+hhGHApJDLLqWgrw/Jg2smrvpsGs7CcwLSmZwVIRts=
  - secure: GMbD65D8psmwsj+M5ieXN66wB1PcfSLi9+77pZjTeSSBHpI/R9+KrfQRrNtnq5K5ZAYyXx90OGlNDn2uKsnv9y9OsICBYmKB3UkxEJVH4u7CKlDTOVavB17iUIjPJBA+WIEoHT1woOr2+CfCfYpDAHT7BQ1hLKZyJnNJyLPvWL4lXF92r6HZq8KAUjZ/6lUGMQyN5COMzrvyy4sc+EK3+yz5xviF4uVUM8uPspHrdC60fKNicNEbhTpEJBTaWFfP72jMYw5JfWYeiBV1AsiYXmkKqvsHBxHn3JKpwz1If4LEKaoBjdtoTsmw94JJvJyWhpEHbGIKOjnCdbYrm3ocdBqr6CSTs402N0k/+YiwYAeY09V68NcsD9lOkrvRz9h9vlbOnTk7ZlvPQm4bG5AMJojPdwOUOHFTrSXaVGxzJt90UVvwwYMtlU3MbRU/uFPqeURlDVJfy5vWk+Yhc3gmjc8s+WGJe4kbAcuM7JUtWQTzUy9zVc8YaNncQj5dL9ML2COvBVyZLD0J7Rx7I93IxT+9fEiuQ5+2GbhqtTwH/RWaxYL0V/TccxXY0wDOdFzUIGuHwEH0jxCO7IkDyXq7IVXCSI9wdUhm2fZUX3T44owovfN+VQhYGIveMg6iHEeFWrx58Gjne2M5+moA/N9+UUWEUZEpaFAgAGxOU3AGcYE=
services:
- docker
before_install:
- pip install docker-compose
- docker login --email=$DOCKER_EMAIL --username=$DOCKER_USER --password=$DOCKER_PASS
script:
- docker-compose -f docker-compose-build.yml build
- docker-compose -f docker-compose-build.yml up -d
- docker exec opac_opac_webapp_1 make test
- docker run -it --net host --pid host --cap-add audit_control -v /var/lib:/var/lib
  -v /var/run/docker.sock:/var/run/docker.sock -v /usr/lib/systemd:/usr/lib/systemd
  -v /etc:/etc --label docker_bench_security docker/docker-bench-security
after_success:
- if [ "$TRAVIS_BRANCH" == "master" ]; then
  docker build -t $TRAVIS_REPO_SLUG .;
  docker push $TRAVIS_REPO_SLUG;
  fi
